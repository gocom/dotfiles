#!/usr/bin/env bash

app_name="${0##*/}"
app_version="0.0.0"

usage () {
  cat <<EOF
Keyword search commits by their message contents.

Usage:
  $ $app_name [options] <keyword ...>

Options:
  -h, --help     Print this message
  -v, --version  Print version number

Examples:
  $ $app_name keyword1 keyword2

EOF
}

main () {
  case "${1:-}" in
    -h|--help) usage ;;
    -v|--version) echo "$app_version" ;;
    *) search "$@" ;;
  esac
}

search () {
  local args option delimiters

  args=()
  delimiters="[/-?!:., ]"

  for option in "$@"; do
    if [[ "$option" == -* ]]; then
      args+=("$option")
    else
      args+=("--grep=^${option}${delimiters}")
      args+=("--grep=${delimiters}${option}$")
      args+=("--grep=${delimiters}${option}${delimiters}")
      args+=("--grep=^${option}$")
    fi
  done

  git log --pretty=logcompact --date=short "${args[@]}"
  exit "$?"
}

main "$@"
